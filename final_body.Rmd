---
output:
  html_document: default
  pdf_document: default
  code_folding: hide
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print = "75")
knitr::opts_chunk$set(
  cache = FALSE, prompt = FALSE,
  tidy = FALSE, comment = NA,
  message = FALSE, warning = FALSE
)
opts_knit$set(width = 75)
```

# Introdution

# Research Questions

# Data Source and Description

# Data Exploration and Munging

# Code and tables

## Syntax highlighting

# Introduction

Colon Cancer background Reocurrance info Survival rate info

### Import Data

```{r}
colonData <- read.table("colon.txt", header = TRUE)

# Grabs Reoccurance Data from colonData
studyA <- subset(colonData, etype==1)

# Grabs Death Data from colonData
studyB <- subset(colonData, etype==2)

# Add year column
studyA$years <- studyA$time / 365.25
studyB$years <- studyB$time / 365.25

# Convert treatment to number
studyA$xnum <- studyA$rx
studyB$xnum <- studyB$rx

studyA$xnum[studyA$xnum == "Obs"] <- 0
studyA$xnum[studyA$xnum == "Lev"] <- 1
studyA$xnum[studyA$xnum == "Lev+5FU"] <- 2

studyB$xnum[studyB$xnum == "Obs"] <- 0
studyB$xnum[studyB$xnum == "Lev"] <- 1
studyB$xnum[studyB$xnum == "Lev+5FU"] <- 2

# Treatment groups 
obsA <- subset(studyA, rx=="Obs")
levA <- subset(studyA, rx=="Lev")
combA <- subset(studyA, rx=="Lev+5FU")

obsB <- subset(studyB, rx=="Obs")
levB <- subset(studyB, rx=="Lev")
combB <- subset(studyB, rx=="Lev+5FU")

# Convert days to years
```

# Research Questions

Treatments types and survival rate and reoccurance (studyA/B) Research
hypothesis

# Data Source and Description

From the study Describe the data 2 events, 3 treatments

# Data Exploration and Munging

## Distributions of Treatments

### Box plots

Reoccurance Data

```{r}
library(ggpubr)
ggboxplot(studyA, x = "rx", y = "years", 
          #color = "rx", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          order = c("Obs", "Lev", "Lev+5FU"),
          ylab = "Years", xlab = "Treatment",)
```

Death Data

```{r}
ggboxplot(studyB, x = "rx", y = "years", 
          #color = "rx", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          order = c("Obs", "Lev", "Lev+5FU"),
          ylab = "Years", xlab = "Treatment",)
```

```{r}
library(gtsummary)
out <- studyA %>% select(status, rx)
tbl_summary(out, by=rx) %>%
  modify_caption("Table 1. Reoccurance by Treatment")
```

```{r}
library(gtsummary)
out <- studyB %>% select(status, rx)
tbl_summary(out, by=rx) %>%
  modify_caption("Table 2. Death by Treatment")
```

### Survival Curve (Kaplan-Meier Survival Plot)

Reoccurance data

```{r}
# Kaplan-Meier Survival Plot (Survival Rate Over Time)
library(survival)
library(survminer)
# Survival curve by treatment
plot(survfit(Surv(years, status) ~ xnum, data=studyA),
     ylab= "Proportion with no Reoccurance",
     xlab = "Years",
     title = "Reoccurance Rate by Treatment",
     col = c(4,2,3),
     pch=c("df","df","df"))
```


Survival Data

```{r}
# Kaplan-Meier Survival Plot (Survival Rate Over Time)
library(survival)
library(survminer)
# Survival curve by treatment
plot(survfit(Surv(years, status) ~ xnum, data=studyB),
     ylab= "Proportion with no Death",
     xlab = "Years",
     title = "Death Rate by Treatment",
     col = c(4,2,3)
     )
```


Survivial Curves with Confidence Intervals

```{r}
# Clean ouput 
library(ggfortify)
library(survival)
fit <- survfit(Surv(years, status) ~ rx, data=studyA)
autoplot(fit)
```


```{r}
fit <- survfit(Surv(years, status) ~ rx, data=studyB)
autoplot(fit)
```


Distribution of status for each treatment Distribution of time for each
treatment Box plots Survival curve Assumptions for T test T tests
Kaplan-Meier survival analysis ## Assumptions for Cox


## T-Test

```{r}
# Calculate Percent Difference
recA = sum(obsA$status==1)
recAC = sum(combA$status==1)
rA = recA/315
rAC = recAC/304
# Percent diff. 35% vs paper 40%
difference = (rA-rAC)/((rA+rAC)/2)
difference


# T test proves sig. diff. in reoccurrence rates between obs and comb
# treatment groups
t.test(obsA$status, combA$status)

# T test also proves sig. diff. in death rates between obs and comb
# treatment groups
t.test(obsB$status, combB$status)
```


## Cox Regression

"Proportional hazards models are a class of survival models in statistics. Survival models relate the time that passes, before some event occurs, to one or more covariates that may be associated with that quantity of time. In a proportional hazards model, the unique effect of a unit increase in a covariate is multiplicative with respect to the hazard rate."

```{r}
library(survival)
coxModelA <- coxph(Surv(time, status) ~ xnum, data=studyA)
summary(coxModelA)

coxModelA %>% 
  gtsummary::tbl_regression(exp = TRUE, label = xnum ~ "Treatment") %>%
  modify_caption("Table 3. Reoccurance Cox Regression")
```


```{r}
library(survival)
coxModelB <- coxph(Surv(time, status) ~ xnum, data=studyB)
summary(coxModelA)

coxModelB %>% 
  gtsummary::tbl_regression(exp = TRUE, label = list(xnum ~ "Treatment")) %>%
  modify_caption("Table 4. Death Rate Cox Regression")
```


This shows a 40% less reduction in the rate of cancer recurrence using
combined therapy. The "Lev" single therapy only offered a 2% reduction
in the reoccurance rate.

# Conclusions

Significance/results from tests Future Study
